{"remainingRequest":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\babel-loader\\lib\\index.js!D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\utils\\request.js","dependencies":[{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\utils\\request.js","mtime":1645498622000},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\babel.config.js","mtime":1645498622000},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\babel-loader\\lib\\index.js","mtime":1674635619784}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkQ6XFxXZWJfREVWX0lOR1xcVnVlLmpzX3RlY2huaWNhbF9mcmFtZXdvcmtcXFZ1ZTJcdTk4NzlcdTc2RUVcdTVCOUVcdTYyMThcXEhlaW1hdG91dGlhby1tYWluXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZVxcaGVscGVyc1xcZXNtXFxhc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJzsKaW1wb3J0IHJvdXRlciBmcm9tICdAL3JvdXRlcic7CmltcG9ydCB7IFRvYXN0IH0gZnJvbSAndmFudCc7CmltcG9ydCB7IEpTT05iaWcgfSBmcm9tICdqc29uLWJpZ2ludCc7CnZhciByZWZyZXNoVG9rZW5SZXEgPSBheGlvcy5jcmVhdGUoewogIGJhc2VVUkw6ICdodHRwOi8vYXBpLXRvdXRpYW8td2ViLml0aGVpbWEubmV0Jwp9KTsKdmFyIHJlcXVlc3QgPSBheGlvcy5jcmVhdGUoewogIGJhc2VVUkw6ICdodHRwOi8vYXBpLXRvdXRpYW8td2ViLml0aGVpbWEubmV0JywKICB0aW1lb3V0OiA1MDAwIC8vIGhlYWRlcnM6IHsKICAvLyAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnCiAgLy8gfQogIC8vIHRyYW5zZm9ybVJlc3BvbnNlOltmdW5jdGlvbihkYXRhKXsKICAvLyAgICAgdHJ5IHsKICAvLyAgICAgICAgIHJldHVybiBKU09OYmlnLnBhcnNlKGRhdGEpCiAgLy8gICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgLy8gICAgICAgICBjb25zb2xlLmxvZygi6L2s5o2i5aSx6LSlIixlcnJvcik7CiAgLy8gICAgICAgICByZXR1cm4gZGF0YQogIC8vICAgICB9CiAgLy8gfV0KCn0pOyAvL+ivt+axguaLpuaIquWZqCAg5Y+R6K+35rGC5LmL5YmN77yM5oum5oiq5Zmo5Y+v5Lul55uR5rWL5YiwCgpyZXF1ZXN0LmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShmdW5jdGlvbiAoY29uZmlnKSB7CiAgLy9jb25maWcg6YWN572u5a+56LGhIAogIHZhciB1c2VyID0gc3RvcmUuc3RhdGUudXNlcjsKCiAgaWYgKHVzZXIpIHsKICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAiQmVhcmVyICIuY29uY2F0KHVzZXIudG9rZW4pOwogIH0KCiAgcmV0dXJuIGNvbmZpZzsKfSk7IC8vIOWTjeW6lOWksei0pQoKcmVxdWVzdC5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKGZ1bmN0aW9uIChyZXNwb25zZSkgewogIHJldHVybiByZXNwb25zZTsKfSwgLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShlcnJvcikgewogICAgdmFyIHN0YXR1cywgdXNlciwgX3lpZWxkJHJlZnJlc2hUb2tlblJlLCBkYXRhOwoKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IucmVzcG9uc2UpOwogICAgICAgICAgICBzdGF0dXMgPSBlcnJvci5yZXNwb25zZS5zdGF0dXM7CgogICAgICAgICAgICBpZiAoIShzdGF0dXMgPT0gNDAwKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlj4LmlbDplJnor68KICAgICAgICAgICAgVG9hc3QuZmFpbCgn6K+35rGC5Y+C5pWw6ZSZ6K+vficpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzE7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgaWYgKCEoc3RhdHVzID09IDQwMSkpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRva2Vu5peg5pWICiAgICAgICAgICAgIC8vIOWmguaenOayoeaciXVzZXIg5YiZ6Lez6L2s55m75b2V6aG16YeN5paw55m75b2VCiAgICAgICAgICAgIC8vIOaciXVzZXIgIOaLv+edgOWIt+aWsHRva2Vu5Y676YeN5paw55m75b2VCiAgICAgICAgICAgIHVzZXIgPSBzdG9yZS5zdGF0ZS51c2VyOwoKICAgICAgICAgICAgaWYgKCEoIXVzZXIgfHwgIXVzZXIudG9rZW4pKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDmnKrnmbvlvZUg6YeN5paw55m75b2VCiAgICAgICAgICAgIHJlZGlyZWN0TG9naW4oKTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI4OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTI7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgcmV0dXJuIHJlZnJlc2hUb2tlblJlcSh7CiAgICAgICAgICAgICAgdXJsOiAnL2FwcC92MV8wL2F1dGhvcml6YXRpb25zJywKICAgICAgICAgICAgICBtZXRob2Q6ICJQVVQiLAogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodXNlci5yZWZyZXNoX3Rva2VuKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgX3lpZWxkJHJlZnJlc2hUb2tlblJlID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgZGF0YSA9IF95aWVsZCRyZWZyZXNoVG9rZW5SZS5kYXRhOwogICAgICAgICAgICB1c2VyLnRva2VuID0gZGF0YS5kYXRhLnRva2VuOwogICAgICAgICAgICBzdG9yZS5jb21taXQoJ1NFVFVTRVInLCB1c2VyKTsgLy8g5aSE55CG5a6MdXNlcnRva2VuIOmHjeaWsOWPkei1t+ivt+axggoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmVxdWVzdChlcnJvci5jb25maWcpKTsKCiAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjI7CiAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMTIpOwogICAgICAgICAgICAvLyDliLfmlrDlpLHotKUg55u05o6l6Lez6L2s55m75b2V6aG1CiAgICAgICAgICAgIFRvYXN0LmZhaWwoJ+eZu+W9lemqjOivgeWksei0pe+8jOivt+mHjeaWsOeZu+W9lX4nKTsKICAgICAgICAgICAgc3RvcmUuc3RhdGUudXNlciA9IG51bGw7CiAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnUkVNT1ZFQ0FDSEVQQUdFJywgJ2xheW91dCcpOwogICAgICAgICAgICByZWRpcmVjdExvZ2luKCk7CgogICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMxOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwMykgewogICAgICAgICAgICAgIC8vIOaXoOadg+mZkAogICAgICAgICAgICAgIFRvYXN0LmZhaWwoJ+aCqOayoeacieadg+mZkH4nKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPj0gNTAwKSB7CiAgICAgICAgICAgICAgLy8g5pyN5Yqh56uv5byC5bi4CiAgICAgICAgICAgICAgVG9hc3QuZmFpbCgn5pyN5Yqh56uv5Ye6546w5byC5bi4ficpOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZWplY3QoZXJyb3IpKTsKCiAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMTIsIDIyXV0pOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCkpOwoKZnVuY3Rpb24gcmVkaXJlY3RMb2dpbigpIHsKICByb3V0ZXIucmVwbGFjZSh7CiAgICBuYW1lOiAnbG9naW4nLAogICAgcXVlcnk6IHsKICAgICAgcmVkaXJlY3Q6IHJvdXRlci5jdXJyZW50Um91dGUuZnVsbFBhdGgKICAgIH0KICB9KTsKfSAvLyDlr7zlh7oKCgpleHBvcnQgZGVmYXVsdCByZXF1ZXN0Ow=="},{"version":3,"sources":["D:/Web_DEV_ING/Vue.js_technical_framework/Vue2项目实战/Heimatoutiao-main/src/utils/request.js"],"names":["axios","store","router","Toast","JSONbig","refreshTokenReq","create","baseURL","request","timeout","interceptors","use","config","user","state","headers","Authorization","token","response","error","console","log","status","fail","redirectLogin","url","method","refresh_token","data","commit","Promise","reject","replace","name","query","redirect","currentRoute","fullPath"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport store from '@/store'\nimport router from '@/router'\nimport {\n    Toast\n} from 'vant'\nimport {\n    JSONbig\n} from 'json-bigint'\n\n\n\n\nconst refreshTokenReq = axios.create({\n    baseURL: 'http://api-toutiao-web.itheima.net',\n})\n\n\nconst request = axios.create({\n    baseURL: 'http://api-toutiao-web.itheima.net',\n    timeout: 5000\n    // headers: {\n    //     'Content-Type': 'application/x-www-form-urlencoded'\n    // }\n    // transformResponse:[function(data){\n    //     try {\n    //         return JSONbig.parse(data)\n    //     } catch (error) {\n    //         console.log(\"转换失败\",error);\n    //         return data\n    //     }\n    // }]\n})\n\n\n//请求拦截器  发请求之前，拦截器可以监测到\nrequest.interceptors.request.use((config) => {\n    //config 配置对象 \n    const {\n        user\n    } = store.state\n    if (user) {\n        config.headers.Authorization = `Bearer ${user.token}`\n    }\n    return config;\n})\n\n\n// 响应失败\nrequest.interceptors.response.use((response) => {\n    return response;\n}, async function (error) {\n    console.log(error.response);\n    const status = error.response.status;\n    if (status == 400) {\n        // 参数错误\n        Toast.fail('请求参数错误~')\n    } else if (status == 401) {\n        // token无效\n        // 如果没有user 则跳转登录页重新登录\n        // 有user  拿着刷新token去重新登录\n        const {\n            user\n        } = store.state;\n        if (!user || !user.token) {\n            // 未登录 重新登录\n            redirectLogin()\n        } else {\n            try {\n                const {\n                    data\n                } = await refreshTokenReq({\n                    url: '/app/v1_0/authorizations',\n                    method: \"PUT\",\n                    headers: {\n                        Authorization: `Bearer ${user.refresh_token}`\n                    }\n                })\n                user.token = data.data.token;\n                store.commit('SETUSER', user);\n                // 处理完usertoken 重新发起请求\n                return request(error.config);\n            } catch (error) {\n                // 刷新失败 直接跳转登录页\n                Toast.fail('登录验证失败，请重新登录~');\n                store.state.user = null;\n                store.commit('REMOVECACHEPAGE', 'layout');\n                redirectLogin()\n            }\n        }\n    } else if (status == 403) {\n        // 无权限\n        Toast.fail('您没有权限~')\n    } else if (status >= 500) {\n        // 服务端异常\n        Toast.fail('服务端出现异常~')\n    }\n\n    return Promise.reject(error)\n})\n\nfunction redirectLogin() {\n    router.replace({\n        name: 'login',\n        query: {\n            redirect: router.currentRoute.fullPath\n        }\n    })\n}\n\n// 导出\nexport default request;"]}]}