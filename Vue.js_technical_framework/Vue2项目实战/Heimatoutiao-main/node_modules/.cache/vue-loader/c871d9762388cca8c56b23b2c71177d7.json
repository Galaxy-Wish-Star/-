{"remainingRequest":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\login\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\login\\index.vue","mtime":1645498622000},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\babel-loader\\lib\\index.js","mtime":1674635619784},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js","mtime":1674635619517}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGxvZ2luLCBzZW5kU21zIH0gZnJvbSAiQC9hcGkiOwppbXBvcnQgeyBUb2FzdCB9IGZyb20gInZhbnQiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImxvZ2luIiwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdXNlcjogewogICAgICAgIG1vYmlsZTogIiIsCiAgICAgICAgY29kZTogIiIsCiAgICAgIH0sCiAgICAgIC8vIOmqjOivgeinhOWImQogICAgICBmb3JtUnVsZXM6IHsKICAgICAgICBtb2JpbGU6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6ICLor7fovpPlhaXmiYvmnLrlj7fvvIEiLAogICAgICAgICAgICB0cmlnZ2VyOiAib25CbHVyIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIHBhdHRlcm46CiAgICAgICAgICAgICAgL14oMTNbMC05XXwxNFswMTQ1Njg3OV18MTVbMC0zNS05XXwxNlsyNTY3XXwxN1swLThdfDE4WzAtOV18MTlbMC0zNS05XSlcZHs4fSQvLAogICAgICAgICAgICBtZXNzYWdlOiAi6K+36L6T5YWl5q2j56Gu55qE5omL5py65Y+377yBIiwKICAgICAgICAgICAgdHJpZ2dlcjogIm9uQmx1ciIsCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgY29kZTogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogIuivt+i+k+WFpemqjOivgeegge+8gSIsCiAgICAgICAgICAgIHRyaWdnZXI6ICJvbkJsdXIiLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgcGF0dGVybjogL1xkezZ9JC8sCiAgICAgICAgICAgIG1lc3NhZ2U6ICLor7fovpPlhaXmraPnoa7nmoTpqozor4HnoIHvvIEiLAogICAgICAgICAgICB0cmlnZ2VyOiAib25CbHVyIiwKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgfSwKICAgICAgaXNDb3VudDogZmFsc2UsCiAgICAgIGlzbG9hZGluZzogZmFsc2UsCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgb25Mb2dpbigpIHsKICAgICAgVG9hc3QubG9hZGluZyh7CiAgICAgICAgbWVzc2FnZTogIueZu+W9leS4rS4uLiIsCiAgICAgICAgZm9yYmlkQ2xpY2s6IHRydWUsIC8v56aB5q2iCiAgICAgICAgZHVyYXRpb246IDAsCiAgICAgIH0pOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgbG9naW4odGhpcy51c2VyKTsKICAgICAgICBUb2FzdC5zdWNjZXNzKCLnmbvlvZXmiJDlip/vvIEiKTsKICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0VXNlciIsIGRhdGEuZGF0YSk7CgogICAgICAgIC8vIOi3s+i9rOS5i+WJjSDmuIXpmaTpobXpnaLnvJPlrZgKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoIlJFTU9WRUNBQ0hFUEFHRSIsICJsYXlvdXQiKTsKCiAgICAgICAgLy8gdGhpcy4kcm91dGVyLmJhY2soKTsKICAgICAgICAvLyDot7Povazlm57ljp/mnaXnmoTpobXpnaIKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh0aGlzLiRyb3V0ZS5xdWVyeS5yZWRpcmVjdCB8fCAiLyIpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICBUb2FzdC5mYWlsKCLnmbvlvZXlpLHotKXvvIEiKTsKICAgICAgfQogICAgfSwKICAgIG9uRmFpbGVkKGVycm9yKSB7CiAgICAgIGlmIChlcnJvci5lcnJvcnNbMF0pIHsKICAgICAgICB0aGlzLiR0b2FzdCh7CiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5lcnJvcnNbMF0ubWVzc2FnZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wIiwKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIG9uU2VuZHNtcygpIHsKICAgICAgLy8g6K6pYnV0dG9u5pi+56S6bG9hZGluZwogICAgICB0aGlzLmlzbG9hZGluZyA9IHRydWU7CiAgICAgIC8vIOagoemqjOaJi+acuuWPt+S5i+WQjuWGjei/m+ihjOWPkemAgQogICAgICB0cnkgewogICAgICAgIGF3YWl0IHRoaXMuJHJlZnNbImxvZ2luLWZvcm0iXS52YWxpZGF0ZSgibW9iaWxlIik7CiAgICAgICAgLy8g6aqM6K+B6YCa6L+HCiAgICAgICAgYXdhaXQgc2VuZFNtcyh0aGlzLnVzZXIubW9iaWxlKTsKICAgICAgICB0aGlzLmlzQ291bnQgPSB0cnVlOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGxldCBtc2cgPSAiIjsKICAgICAgICAvLyDov5vooYzplJnor6/nmoTliKTmlq0KICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09IDQyOSkgewogICAgICAgICAgbXNnID0gIuWPkemAgeWkqumikee5geS6huivt+eojeWQjumHjeivlSI7CiAgICAgICAgfSBlbHNlIGlmIChlcnJvci5uYW1lID09ICJtb2JpbGUiKSB7CiAgICAgICAgICBtc2cgPSBlcnJvci5tZXNzYWdlOwogICAgICAgIH0gZWxzZSBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09IDQwNCkgewogICAgICAgICAgbXNnID0gIuaJi+acuuWPt+mUmeivr++8jOivt+mHjeaWsOWwneivlSI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1zZyA9ICLmnKrnn6XplJnor6/vvIzor7fph43mlrDlsJ3or5UiOwogICAgICAgIH0KICAgICAgICB0aGlzLiR0b2FzdCh7CiAgICAgICAgICBtZXNzYWdlOiBtc2csCiAgICAgICAgICBwb3NpdGlvbjogInRvcCIsCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgLy8g6K6pYnV0dG9u5YWz6ZetbG9hZGluZwogICAgICB0aGlzLmlzbG9hZGluZyA9IGZhbHNlOwogICAgfSwKICB9LAogIGJlZm9yZVJvdXRlRW50ZXIgKHRvLCBmcm9tLCBuZXh0KSB7CiAgICAgIG5leHQodm09PnsKICAgICAgICAgIGlmKHZtLiRzdG9yZS5zdGF0ZS51c2VyKXsKICAgICAgICAgICAgICBUb2FzdCgn5L2g5bey57uP55m76ZmG6L+H5LqGficpOwogICAgICAgICAgICAgIG5leHQoZnJvbSkKICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICB9KQogIH0KfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/login","sourcesContent":["<template>\n  <div>\n    <van-nav-bar title=\"登录\" left-arrow @click-left=\"$router.back()\" />\n    <!-- 表单 -->\n    <van-form\n      @submit=\"onLogin\"\n      @failed=\"onFailed\"\n      ref=\"login-form\"\n      :show-error=\"false\"\n      :show-error-message=\"false\"\n      :validate-first=\"true\"\n    >\n      <van-cell-group>\n        <van-field\n          v-model=\"user.mobile\"\n          class=\"iconfont\"\n          icon-prefix=\"icon\"\n          left-icon=\"shouji\"\n          placeholder=\"请输入手机号\"\n          clearable\n          name=\"mobile\"\n          :rules=\"formRules.mobile\"\n        />\n\n        <van-field\n          v-model=\"user.code\"\n          class=\"iconfont\"\n          icon-prefix=\"icon\"\n          left-icon=\"yanzhengma\"\n          placeholder=\"请输入验证码\"\n          name=\"code\"\n          :rules=\"formRules.code\"\n        >\n          <template #button>\n            <van-count-down\n              class=\"countDown\"\n              @finish=\"isCount = false\"\n              v-if=\"isCount\"\n              format=\"ss秒后可发送\"\n              :time=\"1000 * 5\"\n            />\n            <van-button\n              :loading=\"isloading\"\n              v-if=\"!isCount\"\n              @click.prevent=\"onSendsms\"\n              class=\"send-btn\"\n              size=\"small\"\n              round\n              >获取验证码</van-button\n            >\n          </template>\n        </van-field>\n        <div class=\"login-btn-container\">\n          <van-button class=\"login-btn\" type=\"primary\" block>登录</van-button>\n        </div>\n      </van-cell-group>\n    </van-form>\n  </div>\n</template>\n\n<script>\nimport { login, sendSms } from \"@/api\";\nimport { Toast } from \"vant\";\nexport default {\n  name: \"login\",\n  data() {\n    return {\n      user: {\n        mobile: \"\",\n        code: \"\",\n      },\n      // 验证规则\n      formRules: {\n        mobile: [\n          {\n            required: true,\n            message: \"请输入手机号！\",\n            trigger: \"onBlur\",\n          },\n          {\n            pattern:\n              /^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\\d{8}$/,\n            message: \"请输入正确的手机号！\",\n            trigger: \"onBlur\",\n          },\n        ],\n        code: [\n          {\n            required: true,\n            message: \"请输入验证码！\",\n            trigger: \"onBlur\",\n          },\n          {\n            pattern: /\\d{6}$/,\n            message: \"请输入正确的验证码！\",\n            trigger: \"onBlur\",\n          },\n        ],\n      },\n      isCount: false,\n      isloading: false,\n    };\n  },\n  methods: {\n    async onLogin() {\n      Toast.loading({\n        message: \"登录中...\",\n        forbidClick: true, //禁止\n        duration: 0,\n      });\n      try {\n        const { data } = await login(this.user);\n        Toast.success(\"登录成功！\");\n        this.$store.dispatch(\"setUser\", data.data);\n\n        // 跳转之前 清除页面缓存\n        this.$store.commit(\"REMOVECACHEPAGE\", \"layout\");\n\n        // this.$router.back();\n        // 跳转回原来的页面\n        this.$router.push(this.$route.query.redirect || \"/\");\n      } catch (error) {\n        console.log(error);\n        Toast.fail(\"登录失败！\");\n      }\n    },\n    onFailed(error) {\n      if (error.errors[0]) {\n        this.$toast({\n          message: error.errors[0].message,\n          position: \"top\",\n        });\n      }\n    },\n    async onSendsms() {\n      // 让button显示loading\n      this.isloading = true;\n      // 校验手机号之后再进行发送\n      try {\n        await this.$refs[\"login-form\"].validate(\"mobile\");\n        // 验证通过\n        await sendSms(this.user.mobile);\n        this.isCount = true;\n      } catch (error) {\n        let msg = \"\";\n        // 进行错误的判断\n        if (error && error.response && error.response.status == 429) {\n          msg = \"发送太频繁了请稍后重试\";\n        } else if (error.name == \"mobile\") {\n          msg = error.message;\n        } else if (error.response.status == 404) {\n          msg = \"手机号错误，请重新尝试\";\n        } else {\n          msg = \"未知错误，请重新尝试\";\n        }\n        this.$toast({\n          message: msg,\n          position: \"top\",\n        });\n      }\n      // 让button关闭loading\n      this.isloading = false;\n    },\n  },\n  beforeRouteEnter (to, from, next) {\n      next(vm=>{\n          if(vm.$store.state.user){\n              Toast('你已经登陆过了~');\n              next(from)\n          }else{\n              return true;\n          }\n      })\n  }\n};\n</script>\n\n<style scoped lang=\"less\">\nbody {\n  background-color: #f5f7f9;\n}\n\n.top {\n  background-color: #3296fa;\n  font-size: 16px;\n  color: white;\n  height: 44px;\n}\n\n.login-btn-container {\n  margin: 26px 16px;\n\n  .login-btn {\n    background-color: #3296fa;\n    border: none;\n\n    .van-button__text {\n      font-size: 15px;\n    }\n  }\n}\n\n.send-btn {\n  height: 23px;\n  background-color: #ededed;\n  font-size: 9px;\n  color: #666666;\n}\n.countDown {\n  display: inline-flex;\n  text-align: center;\n  align-items: center;\n  font-size: 9px;\n  color: #666666;\n}\n</style>"]}]}