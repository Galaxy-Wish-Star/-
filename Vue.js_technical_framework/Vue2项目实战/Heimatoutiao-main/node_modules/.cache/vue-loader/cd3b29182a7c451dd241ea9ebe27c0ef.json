{"remainingRequest":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\article\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\article\\index.vue","mtime":1645498622000},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\babel-loader\\lib\\index.js","mtime":1674635619784},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js","mtime":1674635619517}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7CiAgICBhZGRDb2xsZWN0LAogICAgZGVsZXRlQ29sbGVjdCwKICAgIHVzZXJMaWtlLAogICAgdXNlckNhbmNlbExpa2UKfSBmcm9tICdAL2FwaS9hcnRpY2xlJzsKaW1wb3J0IHsKICAgIEltYWdlUHJldmlldywKICAgIFRvYXN0Cn0gZnJvbSAndmFudCc7CmltcG9ydCB7CiAgICBjYW5jZWxGb2xsb3dVc2VyLAogICAgZm9sbG93VXNlcgp9IGZyb20gJ0AvYXBpL3VzZXInOwppbXBvcnQgJ2dpdGh1Yi1tYXJrZG93bi1jc3MnOwppbXBvcnQgewogICAgbWFwU3RhdGUKfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsKICAgIGdldEFydGljbGVCeUlkCn0gZnJvbSAnQC9hcGkvYXJ0aWNsZSc7CmltcG9ydCBjb21tZW50TGlzdCBmcm9tICcuL2NvbXBvbmVudHMvY29tbWVudC1saXN0LnZ1ZSc7CmltcG9ydCBQb3N0Q29tbWVudCBmcm9tICcuL2NvbXBvbmVudHMvcG9zdC1jb21tZW50LnZ1ZSc7CmltcG9ydCBDb21tZW50UmVwbHkgZnJvbSAnLi9jb21wb25lbnRzL2NvbW1lbnQtcmVwbHkudnVlJzsKZXhwb3J0IGRlZmF1bHQgewogICAgY29tcG9uZW50czogewogICAgICAgIGNvbW1lbnRMaXN0LAogICAgICAgIFBvc3RDb21tZW50LAogICAgICAgIENvbW1lbnRSZXBseQogICAgfSwKICAgIG5hbWU6ICdBcnRpY2xlJywKICAgIHByb3BzOiBbJ2FydGljbGVJZCddLAogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBhcnRpY2xlOiB7fSwKICAgICAgICAgICAgaXNGb2xsb3dMb2Rpbmc6IGZhbHNlLAogICAgICAgICAgICBjaGlsZDogZmFsc2UsCiAgICAgICAgICAgIGlzUG9zdFNob3c6IGZhbHNlLAogICAgICAgICAgICBjb21tZW50TGlzdDogW10sCiAgICAgICAgICAgIHRvdGFsQ29tbWVudENvdW50OiAwLAogICAgICAgICAgICBpc1JlcGx5U2hvdzogZmFsc2UsCiAgICAgICAgICAgIHJlcGx5Q29tbWVudDoge30sCiAgICAgICAgICAgIHNjcm9sbFRvcDogMAogICAgICAgIH0KICAgIH0sCiAgICBhc3luYyBjcmVhdGVkKCkgewogICAgICAgIGF3YWl0IHRoaXMuZ2V0QXJ0aWNsZSgpOwogICAgICAgIHRoaXMuY2hpbGQgPSB0cnVlOwogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgLi4ubWFwU3RhdGUoWyd1c2VyJ10pCiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIGFzeW5jIGdldEFydGljbGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIGRhdGEKICAgICAgICAgICAgfSA9IGF3YWl0IGdldEFydGljbGVCeUlkKHRoaXMuYXJ0aWNsZUlkKTsKICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7CiAgICAgICAgICAgIHRoaXMuYXJ0aWNsZSA9IGRhdGEuZGF0YTsKICAgICAgICAgICAgLy8g55Sx5LqO5pu05paw5pWw5o2u5ZCO6KeG5Zu+5pyq56uL5Y2z5Yi35pawIOS9v+eUqG5leHRUaWNrCiAgICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgICAgICAgIC8vIOiOt+WPluWGheWuueWMugogICAgICAgICAgICAgICAgY29uc3QgYXJ0aWNsZUNvbnRlbnQgPSB0aGlzLiRyZWZzWydhcnRpY2xlLWNvbnRlbnQnXTsKICAgICAgICAgICAgICAgIC8vIGRvbeaTjeS9nAogICAgICAgICAgICAgICAgY29uc3QgaW1ncyA9IGFydGljbGVDb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZycpOwogICAgICAgICAgICAgICAgY29uc3QgaW1nUGF0aCA9IFtdCiAgICAgICAgICAgICAgICAvLyDpgY3ljobmr4/kuKppbWcg5re75Yqg54K55Ye75LqL5Lu2CiAgICAgICAgICAgICAgICBpbWdzLmZvckVhY2goKGltZywgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpbWdQYXRoLnB1c2goaW1nLnNyYykKICAgICAgICAgICAgICAgICAgICBpbWcub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2VQcmV2aWV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlczogaW1nUGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0UG9zaXRpb246IGluZGV4CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBvbkZvbGxvdygpIHsKICAgICAgICAgICAgdGhpcy5pc0ZvbGxvd0xvZGluZyA9IHRydWU7CiAgICAgICAgICAgIGlmICh0aGlzLnVzZXIpIHsKICAgICAgICAgICAgICAgIC8vIOWmguaenOW3suWFs+azqOWImeWPluWFswogICAgICAgICAgICAgICAgaWYgKHRoaXMuYXJ0aWNsZS5pc19mb2xsb3dlZCkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IGNhbmNlbEZvbGxvd1VzZXIodGhpcy5hcnRpY2xlLmF1dF9pZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IGZvbGxvd1VzZXIodGhpcy5hcnRpY2xlLmF1dF9pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyDmnKrlhbPms6jliJnlhbPms6gKICAgICAgICAgICAgICAgIHRoaXMuYXJ0aWNsZS5pc19mb2xsb3dlZCA9ICF0aGlzLmFydGljbGUuaXNfZm9sbG93ZWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLiR0b2FzdCh7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ+ivt+eZu+W9leWQjui/m+ihjOaTjeS9nCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXNGb2xsb3dMb2RpbmcgPSBmYWxzZTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIG9uQ29sbGVjdCgpIHsKICAgICAgICAgICAgVG9hc3QubG9hZGluZyh7CiAgICAgICAgICAgICAgICBtZXNzYWdlOiAn5pON5L2c5LitwrfCt8K3JywKICAgICAgICAgICAgICAgIGZvcmJpZENsaWNrOiB0cnVlCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGlmICh0aGlzLnVzZXIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFydGljbGUuaXNfY29sbGVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlQ29sbGVjdCh0aGlzLmFydGljbGUuYXJ0X2lkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYWRkQ29sbGVjdCh0aGlzLmFydGljbGUuYXJ0X2lkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuYXJ0aWNsZS5pc19jb2xsZWN0ZWQgPSAhdGhpcy5hcnRpY2xlLmlzX2NvbGxlY3RlZDsKICAgICAgICAgICAgICAgIFRvYXN0LnN1Y2Nlc3MoewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuYXJ0aWNsZS5pc19jb2xsZWN0ZWQgPyAn5pS26JeP5oiQ5YqfJyA6ICflt7Llj5bmtojmlLbol48nCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kdG9hc3QoewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfor7fnmbvlvZXlkI7ov5vooYzmk43kvZwnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgb25MaWtlKCkgewogICAgICAgICAgICBUb2FzdC5sb2FkaW5nKHsKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfmk43kvZzkuK3Ct8K3wrcnLAogICAgICAgICAgICAgICAgZm9yYmlkQ2xpY2s6IHRydWUKICAgICAgICAgICAgfSkKICAgICAgICAgICAgaWYgKHRoaXMudXNlcikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYXJ0aWNsZS5hdHRpdHVkZSA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHVzZXJMaWtlKHRoaXMuYXJ0aWNsZS5hcnRfaWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYXJ0aWNsZS5hdHRpdHVkZSA9IDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHVzZXJDYW5jZWxMaWtlKHRoaXMuYXJ0aWNsZS5hcnRfaWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYXJ0aWNsZS5hdHRpdHVkZSA9IC0xOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgVG9hc3Quc3VjY2Vzcyh7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ+aTjeS9nOaIkOWKnycKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLiR0b2FzdCh7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ+ivt+eZu+W9leWQjui/m+ihjOaTjeS9nCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBvblBvc3RTdWNjZXNzKGNvbnRlbnQpIHsKICAgICAgICAgICAgdGhpcy5jb21tZW50TGlzdC51bnNoaWZ0KGNvbnRlbnQpOwogICAgICAgICAgICB0aGlzLnRvdGFsQ29tbWVudENvdW50Kys7CiAgICAgICAgICAgIHRoaXMuaXNQb3N0U2hvdyA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgb25SZXBseUNsaWNrKGNvbW1lbnQpIHsKICAgICAgICAgICAgdGhpcy5pc1JlcGx5U2hvdyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMucmVwbHlDb21tZW50ID0gY29tbWVudDsKICAgICAgICAgICAgY29uc29sZS5sb2coY29tbWVudCk7CiAgICAgICAgfQogICAgfSwKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/article","sourcesContent":["<template>\n    <div class=\"article-cotainer\">\n        <van-nav-bar title=\"文章\" left-arrow @click-left=\"$router.back()\" />\n        <!-- 内容区 -->\n        <div class=\"content-wrap\">\n            <h1 class=\"title\">{{article.title}}</h1>\n\n            <van-cell class=\"user-info\">\n                <van-image class=\"user-avatar\" :src=\"article.aut_photo\" round fit=\"cover\" slot=\"icon\" />\n                <div slot=\"title\" class=\"user-name\">{{article.aut_name}}</div>\n                <div slot=\"label\" class=\"time\">{{article.pubdate | xianduiTime}}</div>\n                <van-button @click=\"onFollow\" :type=\"article.is_followed?'default':'info'\" icon=\"plus\"\n                    class=\"follow-button\" round :loading=\"isFollowLoding\" size=\"small\">\n                    {{article.is_followed?'已关注' : '关注'}}</van-button>\n            </van-cell>\n            <div ref=\"article-content\" class=\"content markdown-body\" v-html=\"article.content\">\n            </div>\n            <van-divider>文章到这里结束啦~</van-divider>\n            <div class=\"title\">全部评论</div>\n            <!-- 评论区 -->\n            <comment-list @Reply=\"onReplyClick\" @update-commentLength=\"totalCommentCount=$event\" :list=\"commentList\"\n                :source=\"article.art_id\" v-if=\"child\">\n            </comment-list>\n        </div>\n\n\n        <!-- 底部区域 -->\n        <div class=\"bottom-content\">\n            <van-button @click=\"isPostShow=true\" type=\"default\" class=\"comment-btn\" round size=\"medium\">\n                写评论\n            </van-button>\n            <van-icon name=\"comment-o\" :badge=\"totalCommentCount\" />\n            <van-icon :name=\"article.is_collected?'star':'star-o'\" :color=\"article.is_collected?'orange':''\"\n                @click=\"onCollect\" />\n            <van-icon @click=\"onLike\" :name=\"article.attitude==1?'good-job':'good-job-o'\"\n                :color=\"article.attitude==1?'#3296fa':''\" />\n            <van-icon name=\"share-o\" />\n        </div>\n\n        <!-- 发布评论区 -->\n        <van-popup v-model=\"isPostShow\" position=\"bottom\">\n            <post-comment @post-success=\"onPostSuccess\" :target=\"articleId\"></post-comment>\n        </van-popup>\n\n        <!-- 评论的评论 -->\n        <van-popup v-model=\"isReplyShow\" position=\"bottom\">\n            <comment-reply :articleId=\"articleId\" v-if=\"isReplyShow\" @close=\"isReplyShow=false\" :comment=\"replyComment\">\n            </comment-reply>\n        </van-popup>\n    </div>\n</template>\n\n<script>\n    import {\n        addCollect,\n        deleteCollect,\n        userLike,\n        userCancelLike\n    } from '@/api/article';\n    import {\n        ImagePreview,\n        Toast\n    } from 'vant';\n    import {\n        cancelFollowUser,\n        followUser\n    } from '@/api/user';\n    import 'github-markdown-css';\n    import {\n        mapState\n    } from 'vuex';\n    import {\n        getArticleById\n    } from '@/api/article';\n    import commentList from './components/comment-list.vue';\n    import PostComment from './components/post-comment.vue';\n    import CommentReply from './components/comment-reply.vue';\n    export default {\n        components: {\n            commentList,\n            PostComment,\n            CommentReply\n        },\n        name: 'Article',\n        props: ['articleId'],\n        data() {\n            return {\n                article: {},\n                isFollowLoding: false,\n                child: false,\n                isPostShow: false,\n                commentList: [],\n                totalCommentCount: 0,\n                isReplyShow: false,\n                replyComment: {},\n                scrollTop: 0\n            }\n        },\n        async created() {\n            await this.getArticle();\n            this.child = true;\n        },\n        computed: {\n            ...mapState(['user'])\n        },\n        methods: {\n            async getArticle() {\n                const {\n                    data\n                } = await getArticleById(this.articleId);\n                console.log(data);\n                this.article = data.data;\n                // 由于更新数据后视图未立即刷新 使用nextTick\n                this.$nextTick(() => {\n                    // 获取内容区\n                    const articleContent = this.$refs['article-content'];\n                    // dom操作\n                    const imgs = articleContent.querySelectorAll('img');\n                    const imgPath = []\n                    // 遍历每个img 添加点击事件\n                    imgs.forEach((img, index) => {\n                        imgPath.push(img.src)\n                        img.onclick = function () {\n                            ImagePreview({\n                                images: imgPath,\n                                startPosition: index\n                            })\n                        }\n                    });\n                })\n            },\n            async onFollow() {\n                this.isFollowLoding = true;\n                if (this.user) {\n                    // 如果已关注则取关\n                    if (this.article.is_followed) {\n                        await cancelFollowUser(this.article.aut_id);\n                    } else {\n                        await followUser(this.article.aut_id);\n                    }\n                    // 未关注则关注\n                    this.article.is_followed = !this.article.is_followed;\n                } else {\n                    this.$toast({\n                        message: '请登录后进行操作'\n                    });\n                }\n                this.isFollowLoding = false;\n            },\n            async onCollect() {\n                Toast.loading({\n                    message: '操作中···',\n                    forbidClick: true\n                })\n                if (this.user) {\n                    if (this.article.is_collected) {\n                        await deleteCollect(this.article.art_id);\n                    } else {\n                        await addCollect(this.article.art_id);\n                    }\n                    this.article.is_collected = !this.article.is_collected;\n                    Toast.success({\n                        message: this.article.is_collected ? '收藏成功' : '已取消收藏'\n                    })\n                } else {\n                    this.$toast({\n                        message: '请登录后进行操作'\n                    });\n                }\n            },\n            async onLike() {\n                Toast.loading({\n                    message: '操作中···',\n                    forbidClick: true\n                })\n                if (this.user) {\n                    if (this.article.attitude == -1) {\n                        await userLike(this.article.art_id);\n                        this.article.attitude = 1;\n                    } else {\n                        await userCancelLike(this.article.art_id);\n                        this.article.attitude = -1;\n                    }\n                    Toast.success({\n                        message: '操作成功'\n                    })\n                } else {\n                    this.$toast({\n                        message: '请登录后进行操作'\n                    });\n                }\n            },\n            onPostSuccess(content) {\n                this.commentList.unshift(content);\n                this.totalCommentCount++;\n                this.isPostShow = false;\n            },\n            onReplyClick(comment) {\n                this.isReplyShow = true;\n                this.replyComment = comment;\n                console.log(comment);\n            }\n        },\n    }\n</script>\n\n\n\n<style lang=\"less\" scoped>\n    @media (max-width: 767px) {\n        .markdown-body {\n            padding: 15px;\n        }\n    }\n\n    .article-cotainer {\n        .content-wrap {\n            position: fixed;\n            left: 0;\n            right: 0;\n            top: 46px;\n            bottom: 44px;\n            overflow-y: auto;\n            background-color: white;\n        }\n\n        .title {\n            font-size: 20px;\n            margin: 0;\n            padding: 14px;\n            color: #3a3a3a;\n            background-color: white;\n        }\n\n        .user-info {\n            justify-content: space-around;\n            align-items: center;\n            padding: 10px 14px;\n\n            .user-avatar {\n                width: 35px;\n                height: 35px;\n                margin-right: 8px;\n            }\n\n            .user-name {\n                font-size: 11px;\n                color: #333333;\n            }\n\n            .time {\n                font-size: 11px;\n                color: #b4b4b4;\n            }\n\n            .follow-button {\n                width: 85px;\n                height: 29px;\n            }\n        }\n\n        .markdown-body {\n            padding: 14px;\n            background-color: white;\n        }\n\n        .bottom-content {\n            position: fixed;\n            flex: 1;\n            display: flex;\n            justify-content: space-evenly;\n            align-items: center;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 44px;\n            background-color: white;\n\n            .comment-btn {\n                width: 141px;\n                height: 23px;\n                font-size: 15px;\n            }\n        }\n    }\n</style>"]}]}