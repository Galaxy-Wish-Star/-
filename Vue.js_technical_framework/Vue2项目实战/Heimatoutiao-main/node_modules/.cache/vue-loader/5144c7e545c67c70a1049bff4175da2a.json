{"remainingRequest":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\home\\components\\channel-edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\home\\components\\channel-edit.vue","mtime":1645498622000},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\babel-loader\\lib\\index.js","mtime":1674635619784},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js","mtime":1674635619517}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7CiAgICBnZXRBbGxDaGFubmVscywKICAgIGFkZFVzZXJDaGFubmVscywKICAgIGRlbGV0ZVVzZXJDaGFubmVscwp9IGZyb20gJ0AvYXBpJzsKaW1wb3J0IHsKICAgIG1hcFN0YXRlCn0gZnJvbSAndnVleCcKaW1wb3J0IHsKICAgIHNldEl0ZW0sCiAgICBnZXRJdGVtCn0gZnJvbSAnQC91dGlscy9zdG9yYWdlJwpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAnQ2hhbm5lbGVkaXQnLAogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBhbGxDaGFubm5lbHM6IFtdLAogICAgICAgICAgICBpc0VkaXQ6IGZhbHNlCiAgICAgICAgfQogICAgfSwKICAgIHByb3BzOiB7CiAgICAgICAgY2hhbm5lbHM6IHsKICAgICAgICAgICAgdHlwZTogQXJyYXksCiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBhY3RpdmU6IHsKICAgICAgICAgICAgdHlwZTogTnVtYmVyLAogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIH0KICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgYXN5bmMgbG9hZEFsbENoYW5uZWxzKCkgewogICAgICAgICAgICBjb25zdCB7ZGF0YX0gPSBhd2FpdCBnZXRBbGxDaGFubmVscygpOwogICAgICAgICAgICB0aGlzLmFsbENoYW5ubmVscyA9IGRhdGEuZGF0YS5jaGFubmVsczsKICAgICAgICB9LAogICAgICAgIC8vIOa3u+WKoOmikemBkyDmjIHkuYXljJbvvJrlpoLmnpznmbvlvZXkuobvvIzliJnlrZjlgqjliLDnur/kuIrvvIzlpoLmnpzmnKrnmbvlvZUg5a2Y5YKo5Yiw5pys5ZywCiAgICAgICAgYXN5bmMgb25BZGQoY2hhbm5lbCkgewogICAgICAgICAgICB0aGlzLmNoYW5uZWxzLnB1c2goY2hhbm5lbCk7CiAgICAgICAgICAgIC8vIOWmguaenOeZu+W9leS6hu+8mua3u+WKoOWIsOe6v+S4igogICAgICAgICAgICBpZiAodGhpcy51c2VyKSB7CiAgICAgICAgICAgICAgICBhd2FpdCBhZGRVc2VyQ2hhbm5lbHMoewogICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBpZDogY2hhbm5lbC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgc2VxOiB0aGlzLmNoYW5uZWxzLmxlbmd0aAogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2V0SXRlbSgndXNlci1jaGFubmVscycsIHRoaXMuY2hhbm5lbHMpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyDliKDpmaTmiJbogIXliIfmjaIKICAgICAgICBvblVzZXJDaGFubmVsQ2xpY2soaW5kZXgsY2hhbm5lbCkgewogICAgICAgICAgICBpZiAodGhpcy5pc0VkaXQgJiYgaW5kZXggIT09IDApIHsKICAgICAgICAgICAgICAgIC8vIOWIoOmZpOaTjeS9nAogICAgICAgICAgICAgICAgdGhpcy5kZWxldGVDaGFubmVsKGluZGV4LGNoYW5uZWwpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDliIfmjaLmk43kvZwKICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoQ2hhbm5lbChpbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGRlbGV0ZUNoYW5uZWwoaW5kZXgsY2hhbm5lbCkgewogICAgICAgICAgICAvLyDlpoLmnpzliKDpmaTnmoTmmK/lvZPliY3popHpgZPkuYvliY3nmoTpopHpgZMKICAgICAgICAgICAgaWYgKGluZGV4IDw9IHRoaXMuYWN0aXZlKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGUtYWN0aXZlJywgdGhpcy5hY3RpdmUgLSAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmNoYW5uZWxzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgIC8vIOaVsOaNruaMgeS5heWMlgogICAgICAgICAgICBpZih0aGlzLnVzZXIpewogICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlVXNlckNoYW5uZWxzKGNoYW5uZWwuaWQpCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgc2V0SXRlbSgndXNlci1jaGFubmVscycsIHRoaXMuY2hhbm5lbHMpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzd2l0Y2hDaGFubmVsKGluZGV4KSB7CiAgICAgICAgICAgIC8vIOWIh+aNoumikemBkwogICAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGUtYWN0aXZlJywgaW5kZXgpOwogICAgICAgICAgICAvLyDpgJrnn6XniLbnu4Tku7Yg5YWz6Zet5by55Ye65bGCCgogICAgICAgICAgICB0aGlzLiRlbWl0KCdjbG9zZScpOwogICAgICAgIH0KICAgIH0sCiAgICBtb3VudGVkKCkgewoKICAgICAgICB0aGlzLmxvYWRBbGxDaGFubmVscygpOwogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgLi4ubWFwU3RhdGUoWyd1c2VyJ10pLAogICAgICAgIHJlY29tbWFuZENoYW5uZWxzKCkgewogICAgICAgICAgICAvLyDmjqjojZDpopHpgZMg5omA5pyJ6aKR6YGT5YeP5Y675oiR55qE6aKR6YGTCiAgICAgICAgICAgIHJldHVybiB0aGlzLmFsbENoYW5ubmVscy5maWx0ZXIoY2hhbm5lbCA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuY2hhbm5lbHMuZmluZCh1c2VyQ2hhbm5lbCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJDaGFubmVsLmlkID09PSBjaGFubmVsLmlkCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0KfQo="},{"version":3,"sources":["channel-edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"channel-edit.vue","sourceRoot":"src/views/home/components","sourcesContent":["<template>\n    <div class=\"channel-edit\">\n        <van-cell :border=\"false\">\n            <div class=\"title\" slot=\"title\">我的频道</div>\n            <van-button type=\"danger\" class=\"edit-btn\" @click=\"isEdit=!isEdit\" round size=\"mini\" plain>\n                {{isEdit?'完成':'编辑'}}\n            </van-button>\n        </van-cell>\n        <van-grid :gutter=\"10\">\n            <van-grid-item class=\"grid-item\" :class=\"{ active: index===active}\" v-for=\"channel,index in channels\"\n                :key=\"channel.id\" :icon=\"(isEdit&&index!==0)?'clear':''\" @click=\"onUserChannelClick(index,channel)\"\n                :text=\"channel.name\" />\n        </van-grid>\n\n        <van-cell :border=\"false\">\n            <div class=\"title\" slot=\"title\">频道推荐</div>\n\n        </van-cell>\n        <van-grid :gutter=\"10\">\n            <van-grid-item class=\"grid-item\" @click=\"onAdd(channel)\" v-for=\"channel in recommandChannels\"\n                :key=\"channel.id\" :text=\"channel.name\" />\n        </van-grid>\n    </div>\n</template>\n\n<script>\n    import {\n        getAllChannels,\n        addUserChannels,\n        deleteUserChannels\n    } from '@/api';\n    import {\n        mapState\n    } from 'vuex'\n    import {\n        setItem,\n        getItem\n    } from '@/utils/storage'\n    export default {\n        name: 'Channeledit',\n        data() {\n            return {\n                allChannnels: [],\n                isEdit: false\n            }\n        },\n        props: {\n            channels: {\n                type: Array,\n                required: true\n            },\n            active: {\n                type: Number,\n                required: true\n            }\n        },\n        methods: {\n            async loadAllChannels() {\n                const {data} = await getAllChannels();\n                this.allChannnels = data.data.channels;\n            },\n            // 添加频道 持久化：如果登录了，则存储到线上，如果未登录 存储到本地\n            async onAdd(channel) {\n                this.channels.push(channel);\n                // 如果登录了：添加到线上\n                if (this.user) {\n                    await addUserChannels({\n                        channels: [{\n                            id: channel.id,\n                            seq: this.channels.length\n                        }]\n                    })\n                } else {\n                    setItem('user-channels', this.channels);\n                }\n            },\n            // 删除或者切换\n            onUserChannelClick(index,channel) {\n                if (this.isEdit && index !== 0) {\n                    // 删除操作\n                    this.deleteChannel(index,channel);\n                    \n                } else {\n                    // 切换操作\n                    this.switchChannel(index);\n                }\n            },\n            async deleteChannel(index,channel) {\n                // 如果删除的是当前频道之前的频道\n                if (index <= this.active) {\n                    this.$emit('update-active', this.active - 1);\n                }\n                this.channels.splice(index, 1);\n                // 数据持久化\n                if(this.user){\n                    await deleteUserChannels(channel.id)\n                }else{\n                    setItem('user-channels', this.channels);\n                }\n            },\n            switchChannel(index) {\n                // 切换频道\n                this.$emit('update-active', index);\n                // 通知父组件 关闭弹出层\n\n                this.$emit('close');\n            }\n        },\n        mounted() {\n\n            this.loadAllChannels();\n        },\n        computed: {\n            ...mapState(['user']),\n            recommandChannels() {\n                // 推荐频道 所有频道减去我的频道\n                return this.allChannnels.filter(channel => {\n                    return !this.channels.find(userChannel => {\n                        return userChannel.id === channel.id\n                    })\n                })\n            }\n        }\n    }\n</script>\n\n<style scoped lang=\"less\">\n    // 选中的类名\n    .active {\n        /deep/ .van-grid-item__content {\n\n            background-color: #3296fa !important;\n\n            .van-grid-item__text {\n                color: rgb(255, 255, 255) !important;\n            }\n        }\n    }\n\n    .channel-edit {\n        padding-top: 54px;\n\n        .edit-btn {\n            width: 60px;\n        }\n\n        .title {\n            font-size: 16px;\n            color: #333;\n        }\n\n        .grid-item {\n            width: 80px;\n            height: 43px;\n            text-align: center;\n\n            /deep/ .van-grid-item__content {\n                background-color: #f4f5f6;\n\n                .van-grid-item__text {\n                    font-size: 14px;\n                    color: #222;\n                    margin-top: 0;\n                }\n            }\n\n            /deep/ .van-grid-item__content {\n                position: relative;\n\n                .van-icon {\n                    z-index: 2;\n                    right: -6px;\n                    top: -6px;\n                    font-size: 18px;\n                    color: rgb(92, 92, 92);\n                    position: absolute;\n                }\n            }\n        }\n    }\n</style>"]}]}