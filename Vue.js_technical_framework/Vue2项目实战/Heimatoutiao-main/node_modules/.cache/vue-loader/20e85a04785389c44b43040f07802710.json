{"remainingRequest":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\userprofile\\components\\update-photo.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\userprofile\\components\\update-photo.vue","mtime":1645498622000},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\babel-loader\\lib\\index.js","mtime":1674635619784},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js","mtime":1674635619517}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7CiAgICB1cGRhdGVVc2VyUGhvdG8KfSBmcm9tICdAL2FwaS91c2VyJzsKaW1wb3J0IENyb3BwZXIgZnJvbSAnY3JvcHBlcmpzJzsKaW1wb3J0ICdjcm9wcGVyanMvZGlzdC9jcm9wcGVyLmNzcyc7CmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICd1cGRhdGVQaG90bycsCiAgICBkYXRhKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHBob3RvOiB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTCh0aGlzLmZpbGUpLAogICAgICAgICAgICBjcm9wcGVyOm51bGwKICAgICAgICB9CiAgICB9LAogICAgcHJvcHM6IHsKICAgICAgICBmaWxlOiB7CiAgICAgICAgICAgIHR5cGU6IFtPYmplY3QsIEZpbGVdLAogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIH0KICAgIH0sCiAgICBtb3VudGVkKCl7CiAgICAgICAgY29uc3QgaW1hZ2UgPSB0aGlzLiRyZWZzLmltYWdlOwogICAgICAgIHRoaXMuY3JvcHBlciA9IG5ldyBDcm9wcGVyKGltYWdlLCB7CiAgICAgICAgICAgIHZpZXdNb2RlOjEsCiAgICAgICAgICAgIGRyYWdNb2RlOidtb3ZlJywKICAgICAgICAgICAgYXNwZWN0UmF0aW86MSwKICAgICAgICAgICAgYXV0b0Nyb3BBcmVhOjEsCiAgICAgICAgICAgIGNyb3BCb3hNb3ZhYmxlOnRydWUsCiAgICAgICAgICAgIGNyb3BCb3hSZXNpemFibGU6dHJ1ZSwKICAgICAgICAgICAgYmFja2dyb3VuZDpmYWxzZSwKICAgICAgICAgICAgbW92YWJsZTp0cnVlCiAgICAgICAgfSk7CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIGdldENyb3BwZWRDYW52YXMoKXsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmU9PnsKICAgICAgICAgICAgICAgIHRoaXMuY3JvcHBlci5nZXRDcm9wcGVkQ2FudmFzKCkudG9CbG9iKChibG9iKT0+ewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYmxvYikKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBhc3luYyBvbkNvbmZpcm0oKSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0LmxvYWRpbmcoewogICAgICAgICAgICAgICAgdGl0bGU6ICfkuIrkvKDkuK1+fn4nLAogICAgICAgICAgICAgICAgZm9yYmlkY2xpY2s6IHRydWUsCiAgICAgICAgICAgICAgICBkdXJhdGlvbjowCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC8vIOWwgeijheS6huS4gOS4qmdldENyb3BwZXLlh73mlbDvvIzojrflj5boo4HliarlkI7nmoTlm77niYcKICAgICAgICAgICAgY29uc3QgZmlsZT1hd2FpdCB0aGlzLmdldENyb3BwZWRDYW52YXMoKTsKICAgICAgICAgICAgY29uc3QgZmQgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICAgLy8g5Lyg5YWl5paH5Lu25a+56LGh5bm26L2s5oiQZm9ybURhdGEKICAgICAgICAgICAgZmQuYXBwZW5kKCdwaG90bycsIGZpbGUpCiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZVVzZXJQaG90byhmZCkKCiAgICAgICAgICAgIHRoaXMuJHRvYXN0LnN1Y2Nlc3MoJ+S4iuS8oOaIkOWKn++8gScpOwogICAgICAgICAgICB0aGlzLiRlbWl0KCdjbG9zZScpOwogICAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGUtcGhvdG8nLCB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKSk7CiAgICAgICAgfQogICAgfSwKfQo="},{"version":3,"sources":["update-photo.vue"],"names":[],"mappings":";;;;;;;;;;;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"update-photo.vue","sourceRoot":"src/views/userprofile/components","sourcesContent":["<template>\n    <div class=\"photo-show\">\n        <div class=\"imgbox\">\n            <img class=\"img\" :src=\"photo\" ref=\"image\"/>\n        </div>\n        <van-nav-bar class=\"toolbar\" left-text=\"关闭\" right-text=\"完成\" @click-left=\"$emit('close')\"\n            @click-right=\"onConfirm\" />\n    </div>\n</template>\n\n<script>\n    import {\n        updateUserPhoto\n    } from '@/api/user';\n    import Cropper from 'cropperjs';\n    import 'cropperjs/dist/cropper.css';\n    export default {\n        name: 'updatePhoto',\n        data() {\n            return {\n                photo: window.URL.createObjectURL(this.file),\n                cropper:null\n            }\n        },\n        props: {\n            file: {\n                type: [Object, File],\n                required: true\n            }\n        },\n        mounted(){\n            const image = this.$refs.image;\n            this.cropper = new Cropper(image, {\n                viewMode:1,\n                dragMode:'move',\n                aspectRatio:1,\n                autoCropArea:1,\n                cropBoxMovable:true,\n                cropBoxResizable:true,\n                background:false,\n                movable:true\n            });\n        },\n        methods: {\n            getCroppedCanvas(){\n                return new Promise(resolve=>{\n                    this.cropper.getCroppedCanvas().toBlob((blob)=>{\n                        resolve(blob)\n                    })\n                })\n            },\n            async onConfirm() {\n                this.$toast.loading({\n                    title: '上传中~~~',\n                    forbidclick: true,\n                    duration:0\n                })\n                // 封装了一个getCropper函数，获取裁剪后的图片\n                const file=await this.getCroppedCanvas();\n                const fd = new FormData();\n                // 传入文件对象并转成formData\n                fd.append('photo', file)\n                await updateUserPhoto(fd)\n\n                this.$toast.success('上传成功！');\n                this.$emit('close');\n                this.$emit('update-photo', window.URL.createObjectURL(file));\n            }\n        },\n    }\n</script>\n\n<style lang=\"less\" scoped>\n    .photo-show{\n        display: flex;\n        position: absolute;\n        justify-content: center;\n        align-items: center;\n        width: 100%;\n        height: 100%;\n        bottom: 44px;\n    }\n    .toolbar {\n        position: fixed;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: rgba(255, 254, 254, 0.959);\n    }\n    \n    \n    /deep/ .van-nav-bar__content {\n        background-color: rgba(247, 247, 247, 0.144);\n    }\n    .img{\n        display: block;\n        max-width: 100%;\n    }\n</style>"]}]}