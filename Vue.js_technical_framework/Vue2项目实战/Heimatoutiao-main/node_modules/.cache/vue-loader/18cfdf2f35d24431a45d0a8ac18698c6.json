{"remainingRequest":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\search\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\src\\views\\search\\index.vue","mtime":1645498622000},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\babel-loader\\lib\\index.js","mtime":1674635619784},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674635617236},{"path":"D:\\Web_DEV_ING\\Vue.js_technical_framework\\Vue2项目实战\\Heimatoutiao-main\\node_modules\\vue-loader\\lib\\index.js","mtime":1674635619517}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7VG9hc3R9IGZyb20gJ3ZhbnQnOwppbXBvcnQge21hcFN0YXRlfSBmcm9tICd2dWV4JwppbXBvcnQge2dldFVzZXJIaXN0b3J5fSBmcm9tICdAL2FwaS9zZWFyY2gnCmltcG9ydCB7c2V0SXRlbSxnZXRJdGVtfSBmcm9tICdAL3V0aWxzL3N0b3JhZ2UnCmltcG9ydCBzZWFyY2hTdWdnZXN0aW9uIGZyb20gJy4vY29tcG9uZW50cy9zZWFyY2gtc3VnZ2VzdGlvbi52dWUnOwppbXBvcnQgU2VhcmNoSGlzdG9yeSBmcm9tICcuL2NvbXBvbmVudHMvc2VhcmNoLWhpc3RvcnkudnVlJzsKaW1wb3J0IFNlYXJjaFJlc3VsdCBmcm9tICcuL2NvbXBvbmVudHMvc2VhcmNoLXJlc3VsdC52dWUnOwpleHBvcnQgZGVmYXVsdCB7CiAgICBjb21wb25lbnRzOiB7CiAgICAgICAgc2VhcmNoU3VnZ2VzdGlvbiwKICAgICAgICBTZWFyY2hIaXN0b3J5LAogICAgICAgIFNlYXJjaFJlc3VsdAogICAgfSwKICAgIG5hbWU6ICdzZWFyY2gnLAogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzZWFyY2hUZXh0OiAnJywKICAgICAgICAgICAgaXNSZXN1bHRTaG93OiBmYWxzZSwKICAgICAgICAgICAgc2VhcmNoSGlzdG9yeTogW10KICAgICAgICB9OwogICAgfSwKICAgIG1vdW50ZWQoKSB7CiAgICAgICAgdGhpcy5nZXRIaXN0b3J5KCk7CiAgICB9LAogICAgY29tcHV0ZWQ6ewogICAgICAgIC4uLm1hcFN0YXRlKFsndXNlciddKQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBvblNlYXJjaChzZWFyY2hUZXh0KSB7CiAgICAgICAgICAgIHRoaXMuc2VhcmNoVGV4dCA9IHNlYXJjaFRleHQ7CiAgICAgICAgICAgIC8vIOinpuWPkeaQnOe0oiDov5vooYzmjIHkuYXljJbmkJzntKLljoblj7IKICAgICAgICAgICAgY29uc3QgaW5kZXg9dGhpcy5zZWFyY2hIaXN0b3J5LmluZGV4T2Yoc2VhcmNoVGV4dCk7CiAgICAgICAgICAgIC8vIOmYsuatoumHjeWkjeWKoOWFpQogICAgICAgICAgICBpZihpbmRleCE9PS0xKXsKICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoSGlzdG9yeS5zcGxpY2UoaW5kZXgsMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g57qq5b2V5pCc57Si5Y6G5Y+yCiAgICAgICAgICAgIHRoaXMuc2VhcmNoSGlzdG9yeS51bnNoaWZ0KHNlYXJjaFRleHQpOwogICAgICAgICAgICAvLyAvLyDmnKrnmbvlvZUtIOaUvuWIsGxvY2Fsc3RvcmFnZeS4rQogICAgICAgICAgICAvLyBzZXRJdGVtKCdzZWFyY2hIaXN0b3J5Jyx0aGlzLnNlYXJjaEhpc3RvcnkpOwogICAgICAgICAgICAvLyDnmbvlvZXlkI4g5q+P5qyh5pCc57SiIOWQjuerr+S8muiHquWKqOe6quW9leaQnOe0ouWOhuWPsgogICAgICAgICAgICAvLyDlsZXnpLrmkJzntKLnu5PmnpwKICAgICAgICAgICAgdGhpcy5pc1Jlc3VsdFNob3cgPSB0cnVlOwogICAgICAgIH0sCiAgICAgICAgYXN5bmMgZ2V0SGlzdG9yeSgpewogICAgICAgICAgICAvLyDlkI7nq6/lj6rlrZjlgqjkuoY05p2h5Y6G5Y+y6K6w5b2VCiAgICAgICAgICAgIC8vIOWQiOW5tuWQjuerr+i/lOWbnueahOWOhuWPsuiusOW9leWSjOacrOWcsOeahOWOhuWPsuiusOW9lQogICAgICAgICAgICAvLyBsZXQgc2VhcmNoSGl0b3J5PVtdOwogICAgICAgICAgICAvLyBsZXQgdXNlclNlYXJjaEhpc3Rvcnk9W107CiAgICAgICAgICAgIHRoaXMuc2VhcmNoSGlzdG9yeT1nZXRJdGVtKCdzZWFyY2hIaXN0b3J5Jyl8fFtdOwogICAgICAgICAgICAvLyBpZih0aGlzLnVzZXIpewogICAgICAgICAgICAvLyAgICAgY29uc3R7ZGF0YX09YXdhaXQgZ2V0VXNlckhpc3RvcnkoKTsKICAgICAgICAgICAgLy8gICAgIHVzZXJTZWFyY2hIaXN0b3J5PWRhdGEuZGF0YS5rZXl3b3JkczsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyBpZihsb2NhbEhpc3RvcnkpewogICAgICAgICAgICAvLyAgICAgc2VhcmNoSGl0b3J5PVsuLi5uZXcgU2V0KFsuLi5sb2NhbEhpc3RvcnksLi4udXNlclNlYXJjaEhpc3RvcnldKV07CiAgICAgICAgICAgIC8vIH1lbHNlewogICAgICAgICAgICAvLyAgICAgc2VhcmNoSGl0b3J5PXVzZXJTZWFyY2hIaXN0b3J5OwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIHRoaXMuc2VhcmNoSGlzdG9yeT1zZWFyY2hIaXRvcnk7CiAgICAgICAgfQogICAgfSwKICAgIHdhdGNoOnsKICAgICAgICAvLyDpgJrov4d3YXRjaOe7n+S4gOWkhOeQhmhpc3RvcnkKICAgICAgICBzZWFyY2hIaXN0b3J5OnsKICAgICAgICAgICAgaXNEZWVwOnRydWUsCiAgICAgICAgICAgIGhhbmRsZXIoKXsKICAgICAgICAgICAgICAgIHNldEl0ZW0oJ3NlYXJjaEhpc3RvcnknLHRoaXMuc2VhcmNoSGlzdG9yeSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/search","sourcesContent":["<template>\n    <div class=\"search-container\">\n        <!-- 顶部搜索输入框 -->\n        <form action=\"/\">\n            <van-search v-model=\"searchText\" show-action placeholder=\"请输入搜索关键词\" @search=\"onSearch(searchText)\"\n                @focus=\"isResultShow=false\" @cancel=\"$router.back()\" />\n        </form>\n\n        <!-- 搜索结果 -->\n        <search-result :searchText=\"searchText\" v-if=\"isResultShow\">\n        </search-result>\n\n        <!-- 联想建议 -->\n        <search-suggestion @search=\"onSearch\" :searchText=\"searchText\" v-else-if=\"searchText\">\n        </search-suggestion>\n\n        <!-- 历史记录 -->\n        <search-history\n        @update-history=\"searchHistory = $event\"\n        @search=\"onSearch\"\n        :searchHistory=\"searchHistory\"\n        v-else>\n        </search-history>\n    </div>\n</template>\n\n<script>\n    import {Toast} from 'vant';\n    import {mapState} from 'vuex'\n    import {getUserHistory} from '@/api/search'\n    import {setItem,getItem} from '@/utils/storage'\n    import searchSuggestion from './components/search-suggestion.vue';\n    import SearchHistory from './components/search-history.vue';\n    import SearchResult from './components/search-result.vue';\n    export default {\n        components: {\n            searchSuggestion,\n            SearchHistory,\n            SearchResult\n        },\n        name: 'search',\n        data() {\n            return {\n                searchText: '',\n                isResultShow: false,\n                searchHistory: []\n            };\n        },\n        mounted() {\n            this.getHistory();\n        },\n        computed:{\n            ...mapState(['user'])\n        },\n        methods: {\n            onSearch(searchText) {\n                this.searchText = searchText;\n                // 触发搜索 进行持久化搜索历史\n                const index=this.searchHistory.indexOf(searchText);\n                // 防止重复加入\n                if(index!==-1){\n                    this.searchHistory.splice(index,1);\n                }\n                // 纪录搜索历史\n                this.searchHistory.unshift(searchText);\n                // // 未登录- 放到localstorage中\n                // setItem('searchHistory',this.searchHistory);\n                // 登录后 每次搜索 后端会自动纪录搜索历史\n                // 展示搜索结果\n                this.isResultShow = true;\n            },\n            async getHistory(){\n                // 后端只存储了4条历史记录\n                // 合并后端返回的历史记录和本地的历史记录\n                // let searchHitory=[];\n                // let userSearchHistory=[];\n                this.searchHistory=getItem('searchHistory')||[];\n                // if(this.user){\n                //     const{data}=await getUserHistory();\n                //     userSearchHistory=data.data.keywords;\n                // }\n                // if(localHistory){\n                //     searchHitory=[...new Set([...localHistory,...userSearchHistory])];\n                // }else{\n                //     searchHitory=userSearchHistory;\n                // }\n                // this.searchHistory=searchHitory;\n            }\n        },\n        watch:{\n            // 通过watch统一处理history\n            searchHistory:{\n                isDeep:true,\n                handler(){\n                    setItem('searchHistory',this.searchHistory);\n                }\n            }\n        }\n    }\n</script>\n\n<style scoped lang=\"less\">\n    .search-container {}\n</style>"]}]}